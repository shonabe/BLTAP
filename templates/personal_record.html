{% extends "base.html" %}
{% block content %}



<div class="container mt-5">
  <h1 class="mb-3 text-center fw-bold">ãƒ‘ãƒ¼ã‚½ãƒŠãƒ«è¨˜éŒ²ãƒšãƒ¼ã‚¸</h1>
  <p class="text-center text-muted">å„é›£æ˜“åº¦ã§ã®æˆç¸¾ã¨æ¨ç§»ã‚’ç¢ºèªã§ãã¾ã™</p>
</div>

<a href="{{ url_for('user_maintenance') }}" class="btn btn-outline-secondary rounded-pill px-4 mb-5">
  â† ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã«æˆ»ã‚‹
</a>

<h3 class="mb-3">{{ user.username }}ã•ã‚“ã®è¨˜éŒ²</h3>


<!-- æˆç¸¾ãƒ†ãƒ¼ãƒ–ãƒ« -->
<div class="container mb-5">
  <div class="row g-4">
    {% for level, records, color in [
      ('ğŸŸ¢ Easy', easy_records, 'success'),
      ('ğŸ”µ Normal', normal_records, 'primary'),
      ('ğŸ”´ Hard', hard_records, 'danger')
    ] %}
    <div class="col-md-4">
      <div class="card shadow-sm">
        <div class="card-header bg-{{ color }} text-white fw-bold">
          {{ level }}
        </div>
        <div class="card-body p-0">
          <table class="table table-striped table-hover mb-0">
            <thead class="table-light">
              <tr><th>é †ä½</th><th>æ—¥ä»˜</th><th>ã‚¿ã‚¤ãƒ </th></tr>
            </thead>
            <tbody>
              {% for record in records %}
              <tr>
                <td>{{ loop.index }}</td>
                <td>{{ record.date.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                <td>{{ "%.2f"|format(record.time) }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

<!-- ã‚«ãƒ†ã‚´ãƒªé¸æŠ -->
<!-- <div class="container mb-4">
  <div class="text-center">
    <label for="categorySelect" class="form-label fw-bold">è¡¨ç¤ºã™ã‚‹é›£æ˜“åº¦</label>
    <select id="categorySelect" class="form-select w-auto d-inline-block">
      <option value="easy">Easy</option>
      <option value="normal">Normal</option>
      <option value="hard">Hard</option>
    </select>
  </div>
</div> -->

<!-- ã‚°ãƒ©ãƒ• -->
<!-- <div class="container">
  <div class="row g-4">
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-header bg-info text-white">ã‚¿ã‚¤ãƒ ã®æ¨ç§»</div>
        <div class="card-body">
          <canvas id="timeChart" height="300"></canvas>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-header bg-info text-white">ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å›æ•°</div>
        <div class="card-body">
          <canvas id="countChart" height="300"></canvas>
        </div>
      </div>
    </div>
  </div>
</div> -->

<!-- ã‚°ãƒ©ãƒ•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
<!-- <script>
  console.log('Chart.js version:', Chart.version);
  console.log('Time adapter check:', Chart._adapters._date);
  console.log(window.Chart); // undefinedãªã‚‰èª­ã¿è¾¼ã¾ã‚Œã¦ã„ãªã„
  console.log(window.Chart._adapters._date); // undefinedãªã‚‰ã‚¢ãƒ€ãƒ—ã‚¿æœªç™»éŒ²
  const timeChart = new Chart(document.getElementById('timeChart'), {
    type: 'line',
    data: {
      datasets: [
        {
          label: 'Easy',
          data: [],
          borderColor: 'green',
          fill: false,
          parsing: false,
          hidden: false,
          xAxisID: 'x-easy'
        },
        {
          label: 'Normal',
          data: [],
          borderColor: 'blue',
          fill: false,
          parsing: false,
          hidden: true,
          xAxisID: 'x-normal'
        },
        {
          label: 'Hard',
          data: [],
          borderColor: 'red',
          fill: false,
          parsing: false,
          hidden: true,
          xAxisID: 'x-hard'
        }
      ]
    },
    options: {
      responsive: true,
      scales: {
        'x-easy': {
          type: 'time',
          display: true,
          title: { display: true, text: 'æ—¥ä»˜ï¼ˆEasyï¼‰' },
          time: { displayFormats: { day: 'yy/M/d' } }
        },
        'x-normal': {
          type: 'time',
          display: false,
          title: { display: true, text: 'æ—¥ä»˜ï¼ˆNormalï¼‰' },
          time: { displayFormats: { day: 'yy/M/d' } }
        },
        'x-hard': {
          type: 'time',
          display: false,
          title: { display: true, text: 'æ—¥ä»˜ï¼ˆHardï¼‰' },
          time: { displayFormats: { day: 'yy/M/d' } }
        },
        y: {
          title: { display: true, text: 'ã‚¿ã‚¤ãƒ ï¼ˆç§’ï¼‰' },
          ticks: { callback: val => val + 'ç§’' }
        }
      }
    }
  });

  const countChart = new Chart(document.getElementById('countChart'), {
    type: 'bar',
    data: {
      labels: [],
      datasets: [{
        label: 'å›æ•°',
        backgroundColor: '#0d6efd',
        data: []
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false }
      }
    }
  });

  async function fetchChartData() {
    const res = await fetch("/api/data");
    const data = await res.json();
    console.log(data);

    timeChart.data.datasets[0].data = data.ex.map((x, i) => ({ x, y: data.ey[i] }));
    timeChart.data.datasets[1].data = data.nx.map((x, i) => ({ x, y: data.ny[i] }));
    timeChart.data.datasets[2].data = data.hx.map((x, i) => ({ x, y: data.hy[i] }));
    timeChart.update();

    countChart.data.labels = data.x;
    countChart.data.datasets[0].data = data.y;
    countChart.update();
  }
  setInterval(fetchChartData, 10000);
  
  // fetchChartData();

  document.getElementById('categorySelect').addEventListener('change', function () {
    const selected = this.value;
    timeChart.data.datasets.forEach(ds => {
      ds.hidden = ds.label.toLowerCase() !== selected;
      timeChart.options.scales['x-easy'].display = selected === 'easy';
      timeChart.options.scales['x-normal'].display = selected === 'normal';
      timeChart.options.scales['x-hard'].display = selected === 'hard';
    });
    timeChart.update();
  });
</script> -->

{% endblock %}
